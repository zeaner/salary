<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工资计算器（提桶跑路倒计时版）</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-size: cover;
            background-position: center;
            background-image: url('https://api.dujin.org/bing/1920.php'); /* 默认背景 */
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .container {
            max-width: 500px;
            width: 90%;
            background: rgba(255,255,255,0.85);
            margin: 40px auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #333;
            font-size: 1.8em;
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
            color: #555;
            font-size: 0.95em;
        }
        label i {
            color: #007BFF;
            margin-right: 5px;
        }
        input {
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }
        button {
            display: block;
            width: 100%;
            background: #007BFF;
            color: white;
            border: none;
            padding: 14px;
            margin-top: 20px;
            font-size: 1.1em;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        button:hover {
            background: #0056b3;
        }
        .result, .countdown {
            margin-top: 20px;
            background: rgba(233,245,255,0.9);
            padding: 15px;
            border-radius: 5px;
            color: #333;
            font-weight: bold;
            font-size: 1em;
        }
        .result i, .countdown i {
            color: #28a745;
            margin-right: 5px;
        }
        .progress-label {
            margin-top: 15px;
            font-weight: bold;
            color: #333;
            font-size: 1em;
        }
        .progress-label i {
            color: #007BFF;
            margin-right: 5px;
        }
        .progress-container {
            background: #ddd;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }
        .progress-bar {
            height: 24px;
            width: 0%;
            color: white;
            text-align: center;
            line-height: 24px;
            font-size: 1em;
            background: linear-gradient(270deg, red, orange, yellow, green);
            background-size: 300% 300%;
            animation: flow 5s linear infinite;
            transition: width 0.5s ease;
        }
        #resignCountdown {
            margin-top: 20px;
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            color: #333;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
            font-size: 1em;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        @keyframes flow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        @media (max-width: 400px) {
            h1 { font-size: 1.5em; }
            button { font-size: 1em; padding: 12px; }
            .result, .countdown, #resignCountdown { font-size: 0.95em; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1><i class="fa-solid fa-sack-dollar"></i> 工资计算器</h1>

    <label><i class="fa-solid fa-yen-sign"></i> 月工资 (元):
        <input type="number" id="monthlySalary" placeholder="请输入月工资">
    </label>

    <label><i class="fa-solid fa-calendar-days"></i> 每月工作天数:
        <input type="number" id="workDaysPerMonth" value="21.75">
    </label>

    <label><i class="fa-solid fa-calendar-week"></i> 每周工作天数 (5或6):
        <input type="number" id="workDaysPerWeek" value="5">
    </label>

    <label><i class="fa-solid fa-clock"></i> 上班时间 (HH:MM):
        <input type="time" id="startTime">
    </label>

    <label><i class="fa-solid fa-clock"></i> 下班时间 (HH:MM):
        <input type="time" id="endTime">
    </label>

    <label><i class="fa-solid fa-piggy-bank"></i> 攒钱目标 (元):
        <input type="number" id="targetAmount" placeholder="请输入你的攒钱目标">
    </label>

    <button onclick="startRealtimeUpdate()"><i class="fa-solid fa-calculator"></i> 计算</button>

    <div class="countdown" id="countdown">
        <i class="fa-solid fa-hourglass-half"></i> 倒计时
    </div>

    <div class="progress-label"><i class="fa-solid fa-briefcase"></i> 上班进度：</div>
    <div class="progress-container">
        <div class="progress-bar" id="progressBar">0%</div>
    </div>

    <div class="progress-label"><i class="fa-solid fa-piggy-bank"></i> 攒钱进度：</div>
    <div class="progress-container">
        <div class="progress-bar" id="savingProgressBar">0%</div>
    </div>

    <div id="resignCountdown">
        🚀 提桶跑路倒计时
    </div>

    <div class="result" id="result">
        <i class="fa-solid fa-info-circle"></i> 结果
    </div>
</div>

<script>
    // 随机 Bing 壁纸
    (function setRandomBingBackground() {
        const randomIdx = Math.floor(Math.random() * 8);
        const apiUrl = `https://www.bing.com/HPImageArchive.aspx?format=js&idx=${randomIdx}&n=1`;
        fetch(apiUrl)
            .then(res => res.json())
            .then(data => {
                const imgUrl = 'https://www.bing.com' + data.images[0].url;
                document.body.style.backgroundImage = `url('${imgUrl}')`;
            })
            .catch(err => {
                console.error('获取Bing壁纸失败:', err);
            });
    })();

    let intervalId;
    let animateTargets = {today: 0, month: 0, year: 0};
    let animateCurrents = {today: 0, month: 0, year: 0};

    function animateNumber(key, target) {
        const step = (target - animateCurrents[key]) / 10;
        if (Math.abs(step) < 0.01) {
            animateCurrents[key] = target;
        } else {
            animateCurrents[key] += step;
            requestAnimationFrame(() => animateNumber(key, target));
        }
        updateDisplay();
    }

    function updateDisplay() {
        document.getElementById('result').innerHTML = `
            <p><i class="fa-solid fa-coins"></i> 今天截至现在已赚：<strong>${animateCurrents.today.toFixed(2)} 元</strong></p>
            <p><i class="fa-solid fa-calendar"></i> 本月截至今天已赚：<strong>${animateCurrents.month.toFixed(2)} 元</strong></p>
            <p><i class="fa-solid fa-calendar-check"></i> 今年截至今天已赚：<strong>${animateCurrents.year.toFixed(2)} 元</strong></p>`;
    }

    function getEmoji(progress) {
        if (progress < 20) return '😴';
        if (progress < 40) return '😅';
        if (progress < 60) return '💪';
        if (progress < 80) return '🔥';
        if (progress < 100) return '🤩';
        return '🎉';
    }

    function startRealtimeUpdate() {
        clearInterval(intervalId);
        const monthlySalary = parseFloat(document.getElementById('monthlySalary').value);
        const workDaysPerMonth = parseFloat(document.getElementById('workDaysPerMonth').value);
        const workDaysPerWeek = parseInt(document.getElementById('workDaysPerWeek').value);
        const startTimeStr = document.getElementById('startTime').value;
        const endTimeStr = document.getElementById('endTime').value;
        const targetAmount = parseFloat(document.getElementById('targetAmount').value);
        const countdownDiv = document.getElementById('countdown');
        const progressBar = document.getElementById('progressBar');
        const savingProgressBar = document.getElementById('savingProgressBar');
        const resignCountdown = document.getElementById('resignCountdown');

        if (isNaN(monthlySalary) || isNaN(workDaysPerMonth) || isNaN(workDaysPerWeek) || !startTimeStr || !endTimeStr || isNaN(targetAmount)) {
            document.getElementById('result').innerHTML = `<i class="fa-solid fa-exclamation-triangle" style="color: red;"></i> 请填写所有字段。`;
            countdownDiv.innerHTML = '';
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
            savingProgressBar.style.width = '0%';
            savingProgressBar.textContent = '0%';
            resignCountdown.textContent = '🚀 请填写所有字段后才能计算提桶跑路时间';
            return;
        }

        function update() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const day = now.getDate();
            const workStart = new Date(year, month, day, ...startTimeStr.split(':').map(Number));
            const workEnd = new Date(year, month, day, ...endTimeStr.split(':').map(Number));
            const workHours = (workEnd - workStart) / (1000 * 60 * 60);
            const dailySalary = monthlySalary / workDaysPerMonth;
            const hourlySalary = dailySalary / workHours;

            let earnedToday = 0;
            if (now < workStart) earnedToday = 0;
            else if (now >= workEnd) earnedToday = dailySalary;
            else earnedToday = hourlySalary * ((now - workStart) / 3600000);

            let workDaysPassed = 0;
            for (let d = 1; d <= day; d++) {
                const temp = new Date(year, month, d).getDay();
                if (workDaysPerWeek === 5 && temp !== 0 && temp !== 6) workDaysPassed++;
                else if (workDaysPerWeek === 6 && temp !== 0) workDaysPassed++;
                else if (workDaysPerWeek === 7) workDaysPassed++;
            }
            const earnedThisMonth = dailySalary * workDaysPassed - (dailySalary - earnedToday);

            let workDaysYear = 0;
            for (let m = 0; m <= month; m++) {
                const daysInMonth = new Date(year, m + 1, 0).getDate();
                for (let d = 1; d <= (m === month ? day : daysInMonth); d++) {
                    const temp = new Date(year, m, d).getDay();
                    if (workDaysPerWeek === 5 && temp !== 0 && temp !== 6) workDaysYear++;
                    else if (workDaysPerWeek === 6 && temp !== 0) workDaysYear++;
                    else if (workDaysPerWeek === 7) workDaysYear++;
                }
            }
            const earnedThisYear = dailySalary * workDaysYear - (dailySalary - earnedToday);

            animateTargets.today = earnedToday;
            animateTargets.month = earnedThisMonth;
            animateTargets.year = earnedThisYear;
            animateNumber('today', earnedToday);
            animateNumber('month', earnedThisMonth);
            animateNumber('year', earnedThisYear);

            if (now >= workEnd) {
                countdownDiv.innerHTML = `<i class="fa-solid fa-champagne-glasses"></i> 🎉 恭喜！已经下班啦！`;
                progressBar.style.width = '100%';
                progressBar.textContent = `100% 🎉`;
            } else if (now < workStart) {
                countdownDiv.innerHTML = `<i class="fa-solid fa-mug-hot"></i> 上班还没开始～`;
                progressBar.style.width = '0%';
                progressBar.textContent = `0% 😴`;
            } else {
                const remainingSec = Math.floor((workEnd - now) / 1000);
                const hours = Math.floor(remainingSec / 3600);
                const minutes = Math.floor((remainingSec % 3600) / 60);
                const seconds = remainingSec % 60;
                countdownDiv.innerHTML = `<i class="fa-solid fa-hourglass-half"></i> 还要上班 <strong>${hours}小时 ${minutes}分 ${seconds}秒</strong>`;

                const totalWorkMs = workEnd - workStart;
                const workedMs = now - workStart;
                const percent = Math.min(100, (workedMs / totalWorkMs) * 100);
                progressBar.style.width = percent.toFixed(1) + '%';
                progressBar.textContent = percent.toFixed(1) + '% ' + getEmoji(percent);
            }

            const savingPercent = Math.min(100, (earnedThisYear / targetAmount) * 100);
            savingProgressBar.style.width = savingPercent.toFixed(1) + '%';
            savingProgressBar.textContent = savingPercent.toFixed(1) + '% ' + getEmoji(savingPercent);

            const neededDays = targetAmount / dailySalary;
            const remainingDays = neededDays - workDaysYear + (earnedToday < dailySalary ? 1 : 0);
            if (earnedThisYear >= targetAmount) {
                resignCountdown.textContent = `🎉 恭喜！你已经攒够钱，可以提桶跑路啦！`;
            } else {
                const totalRemainingMs = remainingDays * 24 * 3600 * 1000;
                const endDate = new Date(now.getTime() + totalRemainingMs);
                const diff = endDate - now;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                resignCountdown.textContent = `🏃‍♂️ 你还有 ${days} 天 ${hours} 小时 ${minutes} 分 ${seconds} 秒就可以提桶跑路了，加油打工人！`;
            }
        }

        update();
        intervalId = setInterval(update, 1000);
    }
</script>
</body>
</html>